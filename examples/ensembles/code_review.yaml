id: code-review-ensemble
name: Code Review Ensemble
description: Comprehensive code review with multiple specialized reviewers and voting
type: ensemble
version: 1.0.0
author: nexs-mcp
created_at: "2025-12-20T00:00:00Z"
updated_at: "2025-12-20T00:00:00Z"
tags:
  - example
  - parallel
  - code-review
  - voting
  - quality

# Execution configuration
execution_mode: parallel
aggregation_strategy: voting  # Vote on overall code quality rating

# Shared context
shared_context:
  repository: "github.com/company/project"
  pull_request: "PR #123"
  files_changed: 15
  lines_changed: 450
  programming_language: "go"
  review_criteria:
    - "code_quality"
    - "test_coverage"
    - "security"
    - "performance"
    - "maintainability"

# Parallel reviewers with different specializations
members:
  - agent_id: agent-code-quality-reviewer
    role: code_quality
    priority: 5
    description: "Reviews code quality, patterns, and best practices"
    metadata:
      expertise: "code_quality"
      confidence: 0.9
      weight: 1.5  # Higher weight for core quality
    
  - agent_id: agent-security-reviewer
    role: security
    priority: 5
    description: "Identifies security vulnerabilities and concerns"
    metadata:
      expertise: "security"
      confidence: 0.95
      weight: 2.0  # Highest weight for security
    
  - agent_id: agent-performance-reviewer
    role: performance
    priority: 5
    description: "Analyzes performance implications"
    metadata:
      expertise: "performance"
      confidence: 0.85
      weight: 1.2
    
  - agent_id: agent-test-reviewer
    role: testing
    priority: 5
    description: "Reviews test coverage and quality"
    metadata:
      expertise: "testing"
      confidence: 0.8
      weight: 1.0
    
  - agent_id: agent-documentation-reviewer
    role: documentation
    priority: 5
    description: "Reviews documentation and comments"
    metadata:
      expertise: "documentation"
      confidence: 0.75
      weight: 0.8

# Execution options
execution_options:
  timeout: 240  # 4 minutes
  max_retries: 1
  fail_fast: false
  enable_monitoring: true

# Voting configuration
voting_config:
  weight_by_priority: false  # Use custom weights instead
  weight_by_confidence: true
  minimum_votes: 3
  tie_breaker: "highest_priority"
  custom_weights:
    agent-security-reviewer: 2.0      # Security is critical
    agent-code-quality-reviewer: 1.5  # Quality is important
    agent-performance-reviewer: 1.2   # Performance matters
    agent-test-reviewer: 1.0          # Tests are necessary
    agent-documentation-reviewer: 0.8 # Docs are nice to have

# Possible review outcomes
review_outcomes:
  - APPROVE: "Code meets all quality standards"
  - APPROVE_WITH_SUGGESTIONS: "Minor improvements recommended"
  - REQUEST_CHANGES: "Significant issues must be addressed"
  - REJECT: "Critical problems found"

# Metadata
metadata:
  use_case: "Automated code review with expert consensus"
  estimated_time: "3-4 minutes"
  complexity: "medium"
  benefits:
    - "Multi-perspective review"
    - "Catches diverse issue types"
    - "Weighted expert opinions"
    - "Comprehensive feedback"
  
# Example input
example_input:
  diff: |
    diff --git a/internal/handler.go b/internal/handler.go
    + func ProcessRequest(req *Request) (*Response, error) {
    +   // New handler implementation
    +   data := req.Body
    +   result := processData(data)
    +   return &Response{Data: result}, nil
    + }
  files:
    - path: "internal/handler.go"
      additions: 45
      deletions: 12
    - path: "internal/handler_test.go"
      additions: 89
      deletions: 5
  context:
    feature: "Add new request handler"
    jira_ticket: "PROJ-123"

# Example output
example_output:
  voting_result:
    winner: "APPROVE_WITH_SUGGESTIONS"
    total_votes: 6.5
    winner_votes: 4.2
    percentage: 64.6
    breakdown:
      APPROVE_WITH_SUGGESTIONS: 4.2
      APPROVE: 2.3
    voters:
      - "agent-code-quality-reviewer"
      - "agent-security-reviewer"
      - "agent-performance-reviewer"
      - "agent-test-reviewer"
      - "agent-documentation-reviewer"
  detailed_feedback:
    security:
      status: "pass"
      issues: []
      suggestions:
        - "Consider adding input validation"
    code_quality:
      status: "pass"
      issues:
        - "Minor: Variable naming could be improved"
      suggestions:
        - "Extract processData to separate function"
    performance:
      status: "pass"
      concerns:
        - "Watch for memory allocation in processData"
    testing:
      status: "pass"
      coverage: 87%
      suggestions:
        - "Add edge case tests"
    documentation:
      status: "needs_improvement"
      missing:
        - "Function documentation"
        - "Parameter descriptions"
  overall_recommendation: "APPROVE_WITH_SUGGESTIONS"
  priority_issues: []
  blocking_issues: []
