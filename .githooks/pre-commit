#!/bin/bash
# Pre-commit hook for NEXS MCP
# Ensures code quality before commits

set -e

echo "ğŸ” Running pre-commit checks..."

# 1. Format code
echo "ğŸ“ Formatting code..."
make fmt

# 2. Run linters
echo "ğŸ” Running linters..."
if ! make lint; then
    echo "âŒ Linting failed. Please fix errors before committing."
    exit 1
fi

# 3. Run tests
echo "ğŸ§ª Running tests..."
if ! make test; then
    echo "âŒ Tests failed. Please fix before committing."
    exit 1
fi

# 4. Check for go.mod/go.sum consistency
echo "ğŸ“¦ Checking dependencies..."
go mod tidy
if ! git diff --exit-code go.mod go.sum; then
    echo "âš ï¸  go.mod or go.sum has changes. Adding to commit..."
    git add go.mod go.sum
fi

echo "âœ… Pre-commit checks passed!"
exit 0
