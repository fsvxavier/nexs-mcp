# ============================================
# NEXS-MCP Environment Variables
# ============================================
# Copy this file to .env and fill in your values
#
# Documentation: https://github.com/fsvxavier/nexs-mcp/tree/main/docs

# ============================================
# Core Configuration
# ============================================

# Server name
NEXS_SERVER_NAME=nexs-mcp

# Storage type: memory or file (default: file)
NEXS_STORAGE_TYPE=file

# Data directory (where elements are stored)
NEXS_DATA_DIR=.nexs-mcp/elements

# Base directory (where all nexs-mcp data is stored)
# Metrics, performance, HNSW index, working memory, etc.
# Default: derived from NEXS_DATA_DIR parent
# Examples:
#   Global: NEXS_DATA_DIR=~/.nexs-mcp/elements -> NEXS_BASE_DIR=~/.nexs-mcp
#   Workspace: NEXS_DATA_DIR=.nexs-mcp/elements -> NEXS_BASE_DIR=.nexs-mcp
# This allows all data to share the same base location
# NEXS_BASE_DIR=~/.nexs-mcp

# ============================================
# Logging Configuration
# ============================================

# Log level: debug, info, warn, error (default: info)
NEXS_LOG_LEVEL=info

# Log format: text, json (default: json)
NEXS_LOG_FORMAT=json

# ============================================
# Working Memory Configuration
# ============================================

# Auto-save memories to disk (default: true)
NEXS_AUTO_SAVE_MEMORIES=true

# Auto-save interval (e.g., 30s, 1m, 5m) (default: 5m)
NEXS_AUTO_SAVE_INTERVAL=30s

# Token Metrics Auto-Save Interval
# Controls how frequently token optimization metrics are saved to disk
# Format: duration (e.g., 30s, 5m, 1h)
# Default: 5m
NEXS_TOKEN_METRICS_SAVE_INTERVAL=5m

# Performance Metrics Auto-Save Interval
# Controls how frequently performance metrics (tool calls, durations, errors) are saved to disk
# Format: duration (e.g., 30s, 5m, 1h)
# Default: 5m
NEXS_METRICS_SAVE_INTERVAL=5m

# Enable working memory persistence to disk (default: true)
NEXS_WORKING_MEMORY_PERSISTENCE=true

# Directory for working memory files
# Default: derived from NEXS_DATA_DIR (same base directory as elements)
# If NEXS_DATA_DIR=~/.nexs-mcp/elements -> working_memory=~/.nexs-mcp/working_memory
# Override only if you need a different location
# NEXS_WORKING_MEMORY_DIR=/custom/path/working_memory

# ============================================
# Resources Protocol Configuration
# ============================================

# Enable resources protocol (default: false)
NEXS_RESOURCES_ENABLED=false

# Cache TTL for resources (e.g., 5m, 1h) (default: 5m)
NEXS_RESOURCES_CACHE_TTL=5m

# ============================================
# Compression Configuration
# ============================================

# Enable response compression (default: false)
NEXS_COMPRESSION_ENABLED=false

# Compression algorithm: gzip, zlib (default: gzip)
NEXS_COMPRESSION_ALGORITHM=gzip

# Minimum payload size to compress in bytes (default: 1024)
NEXS_COMPRESSION_MIN_SIZE=1024

# Compression level 1-9, where 1=fast 9=best (default: 6)
NEXS_COMPRESSION_LEVEL=6

# Enable adaptive algorithm selection (default: true)
NEXS_COMPRESSION_ADAPTIVE=true

# ============================================
# Streaming Configuration
# ============================================

# Enable streaming responses (default: false)
NEXS_STREAMING_ENABLED=false

# Number of items per chunk (default: 10)
NEXS_STREAMING_CHUNK_SIZE=10

# Delay between chunks (e.g., 50ms, 100ms) (default: 50ms)
NEXS_STREAMING_THROTTLE=50ms

# Channel buffer size (default: 100)
NEXS_STREAMING_BUFFER_SIZE=100

# ============================================
# Summarization Configuration
# ============================================

# Enable automatic summarization (default: false)
NEXS_SUMMARIZATION_ENABLED=false

# Minimum age before summarizing (e.g., 7d, 168h) (default: 7d)
NEXS_SUMMARIZATION_AGE=168h

# Maximum summary length in characters (default: 500)
NEXS_SUMMARIZATION_MAX_LENGTH=500

# Target compression ratio 0.0-1.0 (default: 0.3 = 70% reduction)
NEXS_SUMMARIZATION_RATIO=0.3

# Preserve extracted keywords in summary (default: true)
NEXS_SUMMARIZATION_PRESERVE_KEYWORDS=true

# Use extractive vs abstractive summarization (default: true)
NEXS_SUMMARIZATION_EXTRACTIVE=true

# ============================================
# Adaptive Cache Configuration
# ============================================

# Enable adaptive cache TTL (default: false)
NEXS_ADAPTIVE_CACHE_ENABLED=false

# Minimum cache TTL (e.g., 1h, 60m) (default: 1h)
NEXS_ADAPTIVE_CACHE_MIN_TTL=1h

# Maximum cache TTL (e.g., 7d, 168h) (default: 7d)
NEXS_ADAPTIVE_CACHE_MAX_TTL=168h

# Baseline cache TTL (e.g., 24h, 1d) (default: 24h)
NEXS_ADAPTIVE_CACHE_BASE_TTL=24h

# ============================================
# Prompt Compression Configuration
# ============================================

# Enable prompt compression (default: false)
NEXS_PROMPT_COMPRESSION_ENABLED=false

# Remove syntactic redundancies (default: true)
NEXS_PROMPT_COMPRESSION_REMOVE_REDUNDANCY=true

# Normalize whitespace (default: true)
NEXS_PROMPT_COMPRESSION_WHITESPACE=true

# Replace verbose phrases with aliases (default: true)
NEXS_PROMPT_COMPRESSION_ALIASES=true

# Maintain JSON/YAML structure (default: true)
NEXS_PROMPT_COMPRESSION_PRESERVE_STRUCTURE=true

# Target compression ratio 0.0-1.0 (default: 0.65 = 35% reduction)
NEXS_PROMPT_COMPRESSION_RATIO=0.65

# Only compress prompts longer than this (default: 500)
NEXS_PROMPT_COMPRESSION_MIN_LENGTH=500

# ============================================
# Vector Store Configuration
# ============================================

# Vector embedding dimension (default: 384)
NEXS_VECTOR_DIMENSION=384

# Similarity metric: cosine, euclidean, dotproduct (default: cosine)
NEXS_VECTOR_SIMILARITY=cosine

# Vector count to switch from linear to HNSW (default: 100)
NEXS_VECTOR_HYBRID_THRESHOLD=100

# ============================================
# HNSW Index Configuration
# ============================================

# Enable HNSW index (default: true)
NEXS_HNSW_ENABLED=true

# Number of bi-directional links per node 8-64 (default: 16)
NEXS_HNSW_M=16

# Level generation multiplier 0.1-0.5 (default: 0.25)
NEXS_HNSW_ML=0.25

# Search candidate list size 10-200 (default: 20)
NEXS_HNSW_EF_SEARCH=20

# Random seed for reproducibility (default: 42)
NEXS_HNSW_SEED=42

# ============================================
# Duplicate Detection Configuration
# ============================================

# Enable duplicate detection (default: true)
NEXS_DUPLICATE_DETECTION_ENABLED=true

# Minimum similarity to consider duplicates 0.0-1.0 (default: 0.95)
NEXS_DUPLICATE_DETECTION_THRESHOLD=0.95

# Minimum content length to check (default: 20)
NEXS_DUPLICATE_DETECTION_MIN_LENGTH=20

# Maximum duplicate groups to return (default: 100)
NEXS_DUPLICATE_DETECTION_MAX_RESULTS=100

# ============================================
# Clustering Configuration
# ============================================

# Enable memory clustering (default: true)
NEXS_CLUSTERING_ENABLED=true

# Clustering algorithm: dbscan, kmeans (default: dbscan)
NEXS_CLUSTERING_ALGORITHM=dbscan

# Minimum memories per cluster (DBSCAN) (default: 3)
NEXS_CLUSTERING_MIN_SIZE=3

# Distance threshold for DBSCAN 0.0-1.0 (default: 0.15)
NEXS_CLUSTERING_EPSILON=0.15

# Number of clusters for K-means (default: 10)
NEXS_CLUSTERING_NUM_CLUSTERS=10

# Maximum iterations for K-means (default: 100)
NEXS_CLUSTERING_MAX_ITERATIONS=100

# ============================================
# Knowledge Graph Configuration
# ============================================

# Enable knowledge graph extraction (default: true)
NEXS_KNOWLEDGE_GRAPH_ENABLED=true

# Extract person names (default: true)
NEXS_KNOWLEDGE_GRAPH_EXTRACT_PEOPLE=true

# Extract organizations (default: true)
NEXS_KNOWLEDGE_GRAPH_EXTRACT_ORGS=true

# Extract URLs (default: true)
NEXS_KNOWLEDGE_GRAPH_EXTRACT_URLS=true

# Extract email addresses (default: true)
NEXS_KNOWLEDGE_GRAPH_EXTRACT_EMAILS=true

# Extract concepts/entities (default: true)
NEXS_KNOWLEDGE_GRAPH_EXTRACT_CONCEPTS=true

# Extract keywords (default: true)
NEXS_KNOWLEDGE_GRAPH_EXTRACT_KEYWORDS=true

# Maximum keywords per memory (default: 10)
NEXS_KNOWLEDGE_GRAPH_MAX_KEYWORDS=10

# Extract relationships (default: true)
NEXS_KNOWLEDGE_GRAPH_EXTRACT_RELATIONSHIPS=true

# Maximum relationships to extract (default: 20)
NEXS_KNOWLEDGE_GRAPH_MAX_RELATIONSHIPS=20

# ============================================
# Memory Consolidation Configuration
# ============================================

# Enable memory consolidation (default: true)
NEXS_MEMORY_CONSOLIDATION_ENABLED=true

# Enable automatic consolidation on schedule (default: false)
NEXS_MEMORY_CONSOLIDATION_AUTO=false

# Interval between auto-consolidations (e.g., 24h, 1d) (default: 24h)
NEXS_MEMORY_CONSOLIDATION_INTERVAL=24h

# Minimum memories to trigger consolidation (default: 10)
NEXS_MEMORY_CONSOLIDATION_MIN_MEMORIES=10

# Include duplicate detection in workflow (default: true)
NEXS_MEMORY_CONSOLIDATION_DUPLICATES=true

# Include clustering in workflow (default: true)
NEXS_MEMORY_CONSOLIDATION_CLUSTERING=true

# Include knowledge extraction in workflow (default: true)
NEXS_MEMORY_CONSOLIDATION_KNOWLEDGE=true

# Include quality scoring in workflow (default: true)
NEXS_MEMORY_CONSOLIDATION_QUALITY=true

# ============================================
# Hybrid Search Configuration
# ============================================

# Enable hybrid search (default: true)
NEXS_HYBRID_SEARCH_ENABLED=true

# Search mode: hnsw, linear, auto (default: auto)
NEXS_HYBRID_SEARCH_MODE=auto

# Minimum similarity for results 0.0-1.0 (default: 0.7)
NEXS_HYBRID_SEARCH_THRESHOLD=0.7

# Maximum search results to return (default: 10)
NEXS_HYBRID_SEARCH_MAX_RESULTS=10

# Vector count to switch from linear to HNSW (default: 100)
NEXS_HYBRID_SEARCH_AUTO_SWITCH=100

# Enable saving HNSW index to disk (default: true)
NEXS_HYBRID_SEARCH_PERSISTENCE=true

# Directory to save HNSW index (default: data/hnsw-index)
NEXS_HYBRID_SEARCH_INDEX_PATH=data/hnsw-index

# ============================================
# Memory Retention Configuration
# ============================================

# Enable memory retention policies (default: true)
NEXS_MEMORY_RETENTION_ENABLED=true

# Minimum quality score to retain 0.0-1.0 (default: 0.5)
NEXS_MEMORY_RETENTION_THRESHOLD=0.5

# Retention for high-quality memories in days (default: 365)
NEXS_MEMORY_RETENTION_HIGH_DAYS=365

# Retention for medium-quality memories in days (default: 180)
NEXS_MEMORY_RETENTION_MEDIUM_DAYS=180

# Retention for low-quality memories in days (default: 90)
NEXS_MEMORY_RETENTION_LOW_DAYS=90

# Enable automatic cleanup of old memories (default: false)
NEXS_MEMORY_RETENTION_AUTO_CLEANUP=false

# Interval between cleanup cycles (e.g., 24h, 1d) (default: 24h)
NEXS_MEMORY_RETENTION_CLEANUP_INTERVAL=24h

# ============================================
# Context Enrichment Configuration
# ============================================

# Enable context enrichment (default: true)
NEXS_CONTEXT_ENRICHMENT_ENABLED=true

# Maximum related memories to include (default: 5)
NEXS_CONTEXT_ENRICHMENT_MAX_MEMORIES=5

# Maximum relationship depth to traverse (default: 2)
NEXS_CONTEXT_ENRICHMENT_MAX_DEPTH=2

# Include relationship metadata (default: true)
NEXS_CONTEXT_ENRICHMENT_RELATIONSHIPS=true

# Include temporal information (default: true)
NEXS_CONTEXT_ENRICHMENT_TIMESTAMPS=true

# Similarity threshold for related memories 0.0-1.0 (default: 0.6)
NEXS_CONTEXT_ENRICHMENT_THRESHOLD=0.6

# ============================================
# Embeddings Configuration
# ============================================

# Embedding provider: onnx, openai, transformers, sentence (default: onnx)
NEXS_EMBEDDINGS_PROVIDER=onnx

# Embedding vector dimension (default: 384)
NEXS_EMBEDDINGS_DIMENSION=384

# Enable embeddings cache (default: true)
NEXS_EMBEDDINGS_CACHE_ENABLED=true

# Cache time-to-live (e.g., 24h, 1d) (default: 24h)
NEXS_EMBEDDINGS_CACHE_TTL=24h

# Maximum cache entries (default: 10000)
NEXS_EMBEDDINGS_CACHE_SIZE=10000

# Batch size for batch operations (default: 32)
NEXS_EMBEDDINGS_BATCH_SIZE=32

# === OpenAI Embeddings Configuration ===
# OpenAI API key (required for openai provider)
NEXS_EMBEDDINGS_OPENAI_API_KEY=

# OpenAI model (default: text-embedding-3-small)
NEXS_EMBEDDINGS_OPENAI_MODEL=text-embedding-3-small

# === Transformers Embeddings Configuration ===
# Path to transformers ONNX model
NEXS_EMBEDDINGS_TRANSFORMERS_MODEL_PATH=

# === ONNX Embeddings Configuration ===
# Path to ONNX model file
# Available models:
#   - models/paraphrase-multilingual-MiniLM-L12-v2/model.onnx (multilingual, 384 dim)
#   - models/ms-marco-MiniLM-L-6-v2/model.onnx (English optimized, 384 dim)
NEXS_EMBEDDINGS_ONNX_MODEL_PATH=models/paraphrase-multilingual-MiniLM-L12-v2/model.onnx

# ============================================
# Skill Extraction Configuration
# ============================================

# Enable skill extraction from personas (default: true)
NEXS_SKILL_EXTRACTION_ENABLED=true

# Automatically extract skills when creating a persona (default: false)
NEXS_SKILL_EXTRACTION_AUTO_ON_CREATE=true

# Skip creating skills that already exist (default: true)
NEXS_SKILL_EXTRACTION_SKIP_DUPLICATES=true

# Minimum skill name length to extract (default: 3)
NEXS_SKILL_EXTRACTION_MIN_NAME_LENGTH=3

# Maximum skills to extract per persona (0 = unlimited) (default: 50)
NEXS_SKILL_EXTRACTION_MAX_PER_PERSONA=50

# Extract from expertise_areas field (default: true)
NEXS_SKILL_EXTRACTION_FROM_EXPERTISE=true

# Extract from custom technical_skills fields (default: true)
NEXS_SKILL_EXTRACTION_FROM_CUSTOM=true

# Automatically update persona with skill references (default: true)
NEXS_SKILL_EXTRACTION_AUTO_UPDATE=true

# ============================================
# NLP Configuration (ONNX Runtime)
# ============================================

# Enable entity extraction (default: false)
# Requires ONNX Runtime and BERT NER model
NEXS_NLP_ENTITY_EXTRACTION_ENABLED=false

# Path to BERT NER ONNX model (default: models/bert-base-ner/model.onnx)
NEXS_NLP_ENTITY_MODEL=models/bert-base-ner/model.onnx

# Minimum confidence score for entities 0.0-1.0 (default: 0.7)
NEXS_NLP_ENTITY_CONFIDENCE_MIN=0.7

# Maximum entities to extract per document (default: 100)
NEXS_NLP_ENTITY_MAX_PER_DOC=100

# Enable sentiment analysis (default: false)
# Requires ONNX Runtime and DistilBERT sentiment model
NEXS_NLP_SENTIMENT_ENABLED=false

# Path to DistilBERT sentiment ONNX model (default: models/distilbert-sentiment/model.onnx)
NEXS_NLP_SENTIMENT_MODEL=models/distilbert-sentiment/model.onnx

# Sentiment confidence threshold 0.0-1.0 (default: 0.6)
NEXS_NLP_SENTIMENT_THRESHOLD=0.6

# Enable topic modeling (default: true)
NEXS_NLP_TOPIC_MODELING_ENABLED=true

# Number of topics to extract (default: 5)
NEXS_NLP_TOPIC_COUNT=5

# Topic modeling algorithm: lda, nmf (default: lda)
NEXS_NLP_TOPIC_ALGORITHM=lda

# Enable GPU acceleration for ONNX (default: false)
# Requires CUDA and compatible GPU
NEXS_NLP_USE_GPU=false

# Enable fallback to CPU if GPU fails (default: true)
NEXS_NLP_ENABLE_FALLBACK=true

# Batch size for ONNX inference (default: 16)
NEXS_NLP_BATCH_SIZE=16

# Maximum sequence length for BERT tokenization (default: 512)
NEXS_NLP_MAX_LENGTH=512

# ============================================
# Legacy Environment Variables (Still Used)
# ============================================

# Embedding provider (legacy, prefer NEXS_EMBEDDINGS_PROVIDER)
# Values: onnx, openai, transformers, sentence, auto
NEXS_EMBEDDING_PROVIDER=onnx

# Transformers cache directory (used by embeddings factory)
NEXS_TRANSFORMERS_CACHE=/app/models

# Enable GPU acceleration (requires CUDA)
NEXS_USE_GPU=false

# Library path for ONNX Runtime
LD_LIBRARY_PATH=/usr/local/lib

# OpenAI API key (legacy, prefer NEXS_EMBEDDINGS_OPENAI_API_KEY)
OPENAI_API_KEY=

# OpenAI model (legacy, prefer NEXS_EMBEDDINGS_OPENAI_MODEL)
NEXS_OPENAI_MODEL=text-embedding-3-small

# Test mode (disable production features, use mock providers)
# Set to "1" to enable test mode
NEXS_TEST_MODE=0

# Collection cache TTL in seconds (default: 86400 = 24 hours)
COLLECTION_CACHE_TTL=86400

# Collection maximum cache size
COLLECTION_CACHE_SIZE=100

# ============================================
# Test & CI Environment Variables
# ============================================

# Skip downloading test models in CI/CD (set to "1" or any value to enable)
SKIP_DOWNLOAD=

# CI environment indicator (automatically set by CI systems)
CI=

# ============================================
# Internal Directories (Auto-configured)
# ============================================

# Home directory (automatically detected from $HOME)
# Used for:
# - ~/.nexs-mcp/metrics - Metrics data
# - ~/.nexs-mcp/performance - Performance metrics
# - ~/.nexs-mcp/hnsw_index.json - HNSW index persistence
# HOME=/home/username

# ============================================
# GitHub Integration (Optional)
# ============================================

# GitHub personal access token
# Get from: https://github.com/settings/tokens
GITHUB_TOKEN=

# GitHub OAuth Client ID
GITHUB_CLIENT_ID=

# ============================================
# Performance Tuning
# ============================================

# GOMAXPROCS: Number of OS threads (0 = auto)
GOMAXPROCS=0

# GOMEMLIMIT: Memory limit (e.g., 512MiB, 2GiB)
GOMEMLIMIT=2GiB

# ============================================
# Docker Configuration
# ============================================

# Docker Hub username
DOCKER_USER=your_dockerhub_username

# Docker Hub access token
DOCKER_TOKEN=dckr_pat_your_docker_token_here

# Docker image name
DOCKER_IMAGE=your_dockerhub_username/nexs-mcp:latest

# Container name
DOCKER_CONTAINER_NAME=nexs-mcp-server

# ============================================
# NPM Package Configuration
# ============================================

# NPM package name (scoped)
NPM_PACKAGE_NAME=@your_npm_username/nexs-mcp-server

# Package version
NPM_PACKAGE_VERSION=1.4.0

# NPM registry URL
NPM_REGISTRY_URL=https://registry.npmjs.org/

# NPM authentication token
NPM_AUTH_TOKEN=npm_your_npm_token_here
