# M0.11: Missing Element Tools - User Guide

## Overview

M0.11 adds 4 new MCP tools to enhance element management and workflow efficiency in NEXS-MCP:

1. **validate_element** - Type-specific comprehensive validation
2. **render_template** - Direct template rendering without element creation
3. **reload_elements** - Hot reload elements from disk
4. **search_portfolio_github** - Search GitHub for NEXS portfolios

---

## 1. validate_element

**Purpose:** Perform comprehensive type-specific validation on elements beyond basic schema checks.

### Usage

```json
{
  "element_id": "persona-12345",
  "element_type": "persona",
  "validation_level": "comprehensive",
  "fix_suggestions": true
}
```

### Parameters

| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| `element_id` | string | ✅ | - | ID of the element to validate |
| `element_type` | enum | ✅ | - | Type: persona, skill, template, agent, memory, ensemble |
| `validation_level` | enum | ❌ | comprehensive | Level: basic, comprehensive, strict |
| `fix_suggestions` | boolean | ❌ | true | Include fix suggestions in output |

### Validation Levels

- **basic**: Required fields, minimum lengths, basic structure
- **comprehensive**: Deep validation, quality checks, consistency
- **strict**: Production requirements (tags, version, author, documentation)

### Output

```json
{
  "element_id": "persona-12345",
  "element_type": "persona",
  "is_valid": true,
  "error_count": 0,
  "warning_count": 1,
  "validation_time": "45ms",
  "warnings": [
    {
      "field": "tags",
      "message": "Consider adding tags for better discoverability",
      "code": "PERSONA_NO_TAGS",
      "suggestion": "Add at least 2 descriptive tags",
      "severity": "warning"
    }
  ],
  "summary": "Validation ✅ PASSED (with 1 warnings)"
}
```

### Type-Specific Validation Rules

#### Persona
- BehavioralTraits: name (min 3 chars), intensity (1-10)
- ExpertiseAreas: domain, level (beginner/intermediate/advanced/expert)
- ResponseStyle: tone, formality, verbosity
- SystemPrompt: 50-2000 characters, must reference name/expertise

#### Skill
- Triggers: type (keyword/pattern/context/manual), valid trigger data
- Procedures: step numbers, action quality (min 5 chars)
- Dependencies: valid skill_id, version compatibility
- Inputs/Outputs: documentation requirements (strict mode)

#### Template
- Content: required, non-empty
- Format: markdown/yaml/json/text
- Variables: name, type, required flag, defaults
- Syntax: valid Handlebars/template syntax

#### Agent
- Goals: minimum 10 characters each
- Actions: name, type (tool/skill/decision/loop)
- MaxIterations: reasonable bounds

#### Memory
- ContentHash: valid SHA-256
- DateCreated: valid YYYY-MM-DD format
- SearchIndex: keyword indexing

#### Ensemble
- Members: agent_id, role, priority (1-10)
- ExecutionMode: sequential/parallel/hybrid
- AggregationStrategy: defined and valid

---

## 2. render_template

**Purpose:** Render templates directly with data without creating element instances.

### Usage

**Mode 1: Render from Template Repository**
```json
{
  "template_id": "template-greeting-001",
  "data": {
    "name": "Alice",
    "role": "Developer"
  },
  "output_format": "text",
  "validate_before_render": true
}
```

**Mode 2: Render Direct Content**
```json
{
  "template_content": "Hello {{name}}, welcome to {{company}}!",
  "data": {
    "name": "Bob",
    "company": "NEXS"
  },
  "output_format": "markdown"
}
```

### Parameters

| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| `template_id` | string | ⚠️* | - | ID of template from repository |
| `template_content` | string | ⚠️* | - | Direct template content |
| `data` | object | ✅ | - | Variables for template substitution |
| `output_format` | enum | ❌ | text | Format: text, markdown, yaml, json |
| `validate_before_render` | boolean | ❌ | true | Validate template syntax before rendering |

*Either `template_id` OR `template_content` required (not both)

### Output

```json
{
  "rendered_output": "Hello Alice, welcome to NEXS!",
  "variables_used": ["name", "company"],
  "missing_variables": [],
  "render_time_ms": 23,
  "warnings": [],
  "format": "text"
}
```

### Handlebars Helpers

Available helpers (from InstantiationEngine):
- `upper`, `lower`, `capitalize`
- `date`, `time`, `now`
- `json`, `yaml`
- `default`, `coalesce`
- And more...

---

## 3. reload_elements

**Purpose:** Hot reload elements from disk without restarting the MCP server.

### Usage

**Reload All Elements**
```json
{
  "element_types": ["all"],
  "clear_caches": true,
  "validate_after_reload": true
}
```

**Reload Specific Types**
```json
{
  "element_types": ["persona", "skill"],
  "clear_caches": true,
  "validate_after_reload": false
}
```

### Parameters

| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| `element_types` | array | ❌ | ["all"] | Types to reload (or "all") |
| `clear_caches` | boolean | ❌ | true | Clear template/collection caches |
| `validate_after_reload` | boolean | ❌ | true | Validate elements after reload |

### Output

```json
{
  "elements_reloaded": [
    {"type": "persona", "count": 15},
    {"type": "skill", "count": 23},
    {"type": "template", "count": 8}
  ],
  "elements_failed": [
    {"type": "agent", "count": 1}
  ],
  "validation_errors": [
    {
      "element_id": "agent-broken-001",
      "element_type": "agent",
      "error": "missing required field: goals"
    }
  ],
  "cache_stats": {
    "before_size": 50,
    "after_size": 46,
    "cleared": 50
  },
  "reload_time_ms": 234,
  "total_reloaded": 46,
  "total_failed": 1
}
```

### Use Cases

- After manual edits to element YAML files
- Bulk import/update operations
- Development workflow (edit → reload → test)
- Cache invalidation for performance issues

---

## 4. search_portfolio_github

**Purpose:** Search GitHub repositories for NEXS portfolios and elements.

### Usage

```json
{
  "query": "data science personas",
  "element_type": "persona",
  "author": "nexs-community",
  "tags": ["data-science", "ML"],
  "sort_by": "stars",
  "limit": 20,
  "include_archived": false
}
```

### Parameters

| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| `query` | string | ✅ | - | Search keywords |
| `element_type` | enum | ❌ | all | Filter by type |
| `author` | string | ❌ | - | GitHub username/org filter |
| `tags` | array | ❌ | - | Tag filters |
| `sort_by` | enum | ❌ | relevance | Sort: stars, updated, created, relevance |
| `limit` | integer | ❌ | 20 | Max results (1-100) |
| `include_archived` | boolean | ❌ | false | Include archived repos |

### Output

```json
{
  "results": [
    {
      "repo_name": "nexs-community/data-science-portfolio",
      "repo_url": "https://github.com/nexs-community/data-science-portfolio",
      "description": "Collection of data science personas and skills",
      "stars": 42,
      "updated_at": "2025-12-15T10:30:00Z",
      "elements_found": [
        {
          "id": "persona-data-scientist",
          "name": "Data Scientist",
          "type": "persona",
          "description": "Expert in statistical analysis and ML",
          "version": "2.1.0",
          "author": "nexs-community",
          "tags": ["data-science", "statistics", "ML"],
          "file_path": "personas/data-scientist.yaml"
        }
      ],
      "match_score": 0.95
    }
  ],
  "total_count": 12,
  "page": 1,
  "has_more": false,
  "search_time_ms": 1523
}
```

### Status

⚠️ **Note**: This tool has a placeholder implementation. Full GitHub API integration requires:
- GitHub authentication (use `github_auth_start` first)
- Repository search implementation
- Element content parsing
- Result ranking algorithm

---

## Performance Targets

| Tool | Target | Notes |
|------|--------|-------|
| validate_element | <50ms | Per element validation |
| render_template | <100ms | Complex templates with loops |
| reload_elements | <500ms | 1000 elements full reload |
| search_portfolio_github | <2000ms | Depends on GitHub API latency |

---

## Error Codes Reference

### Validation Error Codes

**Persona:**
- `PERSONA_NO_TAGS` - Missing tags (strict mode)
- `PERSONA_INVALID_TRAIT` - Invalid behavioral trait
- `PERSONA_INVALID_EXPERTISE` - Invalid expertise area
- `PERSONA_SHORT_PROMPT` - System prompt too short

**Skill:**
- `SKILL_NO_TRIGGERS` - Missing triggers
- `SKILL_PROC_NO_ACTION` - Procedure missing action
- `SKILL_NO_TAGS` - Missing tags (strict mode)
- `SKILL_NO_INPUTS` - Missing input documentation (strict)

**Template:**
- `TEMPLATE_NO_CONTENT` - Missing content
- `TEMPLATE_INVALID_FORMAT` - Invalid format
- `TEMPLATE_VAR_NO_TYPE` - Variable missing type
- `TEMPLATE_SYNTAX_ERROR` - Invalid template syntax

---

## Best Practices

### Validation Workflow
```
1. Create/update element
2. Run validate_element (comprehensive)
3. Fix errors based on suggestions
4. Run validate_element (strict) before production
5. Deploy
```

### Template Rendering
```
1. Use template_id mode for reusable templates
2. Use template_content mode for one-off renders
3. Always enable validate_before_render in production
4. Check missing_variables before critical operations
```

### Element Reloading
```
1. Make file changes
2. Run reload_elements with validation enabled
3. Check validation_errors
4. Fix any broken elements
5. Re-run reload_elements
```

### GitHub Portfolio Search
```
1. Authenticate with github_auth_start
2. Search with specific queries
3. Filter by element_type and tags
4. Review match_score for relevance
5. Clone/import high-scoring matches
```

---

## Integration Examples

### Claude Desktop Config

Add to `claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "nexs": {
      "command": "/path/to/nexs-mcp",
      "args": ["--data-dir", "~/nexs-portfolio"]
    }
  }
}
```

### CLI Usage

```bash
# Validate all personas
nexs-mcp validate-elements --type persona --level strict

# Render greeting template
nexs-mcp render-template --id greeting-001 --data '{"name":"Alice"}'

# Reload changed elements
nexs-mcp reload-elements --types persona,skill --validate

# Search GitHub for ML personas
nexs-mcp search-github --query "machine learning" --type persona
```

---

## Changelog

### v0.11.0 (2025-12-19)

**Added:**
- ✅ validate_element tool with 3-level validation
- ✅ render_template tool with 2 rendering modes
- ✅ reload_elements tool with hot reload
- ✅ search_portfolio_github tool (placeholder)
- ✅ internal/validation package (950 LOC)
- ✅ Type-specific validators for 6 element types
- ✅ Validation error codes and fix suggestions

**Implementation Stats:**
- Total LOC: ~1,619
- New files: 8
- Test coverage: In progress
- Build status: ✅ Passing

---

## Support

For issues, questions, or contributions:
- GitHub: https://github.com/fsvxavier/nexs-mcp
- Docs: ./docs/
- ADR: ./docs/adr/ADR-010-missing-element-tools.md
